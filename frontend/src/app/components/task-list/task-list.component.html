<div class="container">
  <h2>{{ editingTask ? 'Editar Tarefa' : 'Nova Tarefa' }}</h2>

  <div *ngIf="message" [ngClass]="messageType === 'success' ? 'message success' : 'message error'">
    {{ message }}
  </div>

  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="titulo">Título:</label>
      <input id="titulo" formControlName="titulo" placeholder="Título da tarefa">
    </div>

    <div class="form-group">
      <label for="descricao">Descrição:</label>
      <textarea id="descricao" formControlName="descricao" placeholder="Descrição detalhada"></textarea>
    </div>

    <div class="form-group">
      <label for="userId">Usuário Responsável:</label>
      <select id="userId" formControlName="userId">
        <option [ngValue]="null" disabled>Selecione um usuário</option>
        <option *ngFor="let user of users" [value]="user.id">{{ user.nome }}</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="dataLimite">Data Limite:</label>
      <input id="dataLimite" type="datetime-local" formControlName="dataLimite">
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="taskForm.invalid">
        {{ editingTask ? 'Atualizar' : 'Salvar' }}
      </button>
      <button type="button" (click)="onCancel()" *ngIf="editingTask">
        Cancelar Edição
      </button>
    </div>
  </form>

  <hr>

  <h2>Lista de Tarefas</h2>

  <form [formGroup]="filterForm" class="filter-form">
    <div class="form-group">
      <label for="filterStatus">Filtrar por Status:</label>
      <select id="filterStatus" formControlName="status">
        <option value="">Todos</option>
        <option *ngFor="let status of TaskStatus | keyvalue" [value]="status.key">{{ status.value }}</option>
      </select>
    </div>
    <div class="form-group">
      <label for="filterUser">Filtrar por Usuário:</label>
      <select id="filterUser" formControlName="userId">
        <option value="">Todos</option>
        <option *ngFor="let user of users" [value]="user.id">{{ user.nome }}</option>
      </select>
    </div>
  </form>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Título</th>
        <th>Usuário Responsável</th>
        <th>Data Limite</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks">
        <td>{{ task.id }}</td>
        <td>{{ task.titulo }}</td>
        <td>{{ getUserName(task.userId) }}</td>
        <td>{{ task.dataLimite | date: 'dd/MM/yyyy HH:mm' }}</td>
        <td>
          <select [value]="task.status" (change)="updateTaskStatus(task, $event)">
            <option *ngFor="let status of TaskStatus | keyvalue" [value]="status.key">{{ status.value }}</option>
          </select>
        </td>
        <td>
          <button (click)="onEdit(task)">Editar</button>
          <button (click)="onDelete(task.id)" class="delete-btn">Excluir</button>
        </td>
      </tr>
      <tr *ngIf="tasks.length === 0">
        <td colspan="6">Nenhuma tarefa encontrada.</td>
      </tr>
    </tbody>
  </table>
</div>
